//
//  CalculationModels.swift
//  Calculator
//
//  Created by Константин Савялов on 18.11.2025.
//

import Foundation

/// # Результат расчета BEMT
/// Содержит комплексные результаты расчета по теории элемента лопасти и импульса
/// Включает метрики производительности, данные о сходимости и детальную информацию по элементам
public struct BEMTResult {
    
    // MARK: - Публичные свойства
    
    /// ## Суммарная тяга
    /// Общая тяга, создаваемая всеми пропеллерами в Ньютонах
    /// Основная метрика производительности двигательной системы
    public let thrust: Double
    
    /// ## Суммарный крутящий момент
    /// Общий крутящий момент, требуемый для вращения всех пропеллеров в Ньютон-метрах
    /// Используется для выбора мотора и расчета мощности
    public let torque: Double
    
    /// ## Суммарная мощность
    /// Общая механическая мощность, потребляемая всеми пропеллерами в Ваттах
    /// Рассчитывается как крутящий момент × угловая скорость
    public let power: Double
    
    /// ## Эффективность пропеллера
    /// Общая эффективность системы пропеллеров (от 0.0 до 1.0)
    /// Отношение полезной мощности к входной мощности
    public let efficiency: Double
    
    /// ## Информация о сходимости
    /// Детальные данные о процессе итерационного решения
    /// Включает количество итераций, невязки и статус сходимости
    public let convergenceInfo: ConvergenceInfo
    
    /// ## Данные по элементам
    /// Опциональные детальные данные для каждого элемента лопасти
    /// Обеспечивает понимание радиального распределения сил и условий потока
    public let elementData: [BladeElementData]?
    
    // MARK: - Инициализация
    
    /// ## Инициализатор результата BEMT
    /// Создает полный результат расчета BEMT
    /// - Parameters:
    ///   - thrust: Суммарная тяга в Н
    ///   - torque: Суммарный крутящий момент в Н·м
    ///   - power: Суммарная мощность в Вт
    ///   - efficiency: Эффективность пропеллера
    ///   - convergenceInfo: Данные о сходимости
    ///   - elementData: Опциональные данные по элементам
    public init(thrust: Double, torque: Double, power: Double, efficiency: Double,
                convergenceInfo: ConvergenceInfo, elementData: [BladeElementData]?) {
        self.thrust = thrust
        self.torque = torque
        self.power = power
        self.efficiency = efficiency
        self.convergenceInfo = convergenceInfo
        self.elementData = elementData
    }
}

/// # Информация о сходимости
/// Детальные данные о процессе итерационного решения в расчете BEMT
/// Помогает пользователям понять надежность и точность результатов
public struct ConvergenceInfo {
    
    // MARK: - Публичные свойства
    
    /// ## Количество итераций
    /// Количество выполненных итераций для достижения сходимости
    /// Большие значения могут указывать на сложные условия сходимости
    public let iterations: Int
    
    /// ## Максимальная невязка
    /// Наибольшее значение невязки при сходимости
    /// Показывает, насколько хорошо решение удовлетворяет уравнениям
    public let maxResidual: Double
    
    /// ## Статус сходимости
    /// Успешно ли завершился итерационный процесс
    /// False указывает, что решение может быть ненадежным
    public let converged: Bool
    
    /// ## История невязок
    /// Массив значений невязок с каждой итерации
    /// Показывает траекторию сходимости и стабильность
    public let residualHistory: [Double]
    
    /// ## Итерации по элементам
    /// Количество итераций, требуемых для каждого элемента лопасти
    /// Идентифицирует проблемные радиальные позиции
    public let elementWiseIterations: [Int]
    
    // MARK: - Инициализация
    
    /// ## Инициализатор информации о сходимости
    /// Создает информацию о сходимости для результатов BEMT
    /// - Parameters:
    ///   - iterations: Количество итераций
    ///   - maxResidual: Максимальное значение невязки
    ///   - converged: Статус сходимости
    ///   - residualHistory: История невязок
    ///   - elementWiseIterations: Итерации на элемент
    public init(iterations: Int, maxResidual: Double, converged: Bool,
                residualHistory: [Double], elementWiseIterations: [Int]) {
        self.iterations = iterations
        self.maxResidual = maxResidual
        self.converged = converged
        self.residualHistory = residualHistory
        self.elementWiseIterations = elementWiseIterations
    }
}

/// # Данные элемента лопасти
/// Детальные аэродинамические и производительностные данные для отдельных элементов лопасти
/// Используется для продвинутого анализа и оптимизации
public struct BladeElementData {
    
    // MARK: - Публичные свойства
    
    /// ## Радиальная позиция
    /// Расстояние от центра вращения до центра элемента в метрах
    /// Определяет местоположение вдоль размаха лопасти
    public let radius: Double
    
    /// ## Тяга элемента
    /// Вклад в тягу от этого элемента в Ньютонах
    /// Показывает как тяга распределена вдоль лопасти
    public let thrust: Double
    
    /// ## Крутящий момент элемента
    /// Вклад в крутящий момент от этого элемента в Ньютон-метрах
    /// Показывает как крутящий момент распределен вдоль лопасти
    public let torque: Double
    
    /// ## Угол атаки
    /// Локальный угол атаки в радианах
    /// Ключевой аэродинамический параметр для каждого элемента
    public let alpha: Double
    
    /// ## Коэффициент подъемной силы
    /// Локальный коэффициент подъемной силы для профиля
    /// Определяет несущую способность в этом элементе
    public let cl: Double
    
    /// ## Коэффициент лобового сопротивления
    /// Локальный коэффициент лобового сопротивления для профиля
    /// Определяет потери на сопротивление в этом элементе
    public let cd: Double
    
    /// ## Число Рейнольдса
    /// Локальное число Рейнольдса на основе хорды и условий потока
    /// Влияет на производительность профиля и поведение перехода
    public let reynolds: Double
    
    /// ## Число Маха
    /// Локальное число Маха на основе скорости потока
    /// Важно для эффектов сжимаемости на высоких скоростях
    public let mach: Double
    
    /// ## Количество итераций
    /// Количество итераций, потребовавшихся для сходимости этого элемента
    /// Указывает на численные сложности в этой радиальной позиции
    public let iterations: Int
    
    // MARK: - Инициализация
    
    /// ## Инициализатор данных элемента лопасти
    /// Создает детальные данные элемента для анализа
    /// - Parameters:
    ///   - radius: Радиальная позиция в метрах
    ///   - thrust: Вклад в тягу в Н
    ///   - torque: Вклад в крутящий момент в Н·м
    ///   - alpha: Угол атаки в радианах
    ///   - cl: Коэффициент подъемной силы
    ///   - cd: Коэффициент лобового сопротивления
    ///   - reynolds: Число Рейнольдса
    ///   - mach: Число Маха
    ///   - iterations: Количество итераций
    public init(radius: Double, thrust: Double, torque: Double, alpha: Double, cl: Double,
                cd: Double, reynolds: Double, mach: Double, iterations: Int) {
        self.radius = radius
        self.thrust = thrust
        self.torque = torque
        self.alpha = alpha
        self.cl = cl
        self.cd = cd
        self.reynolds = reynolds
        self.mach = mach
        self.iterations = iterations
    }
}
